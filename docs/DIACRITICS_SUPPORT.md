# Поддержка диакритики в EPUB (IAST и Санскрит)

## Обзор

EPUB генератор `telegraph-publisher` имеет встроенную поддержку корректного отображения текста на санскрите с диакритикой (IAST — International Alphabet of Sanskrit Transliteration) на всех устройствах чтения, включая Kindle Paperwhite.

## Использование

### Инлайновый код (одиночные backticks)

Для выделения отдельных слов на санскрите используйте **одинарные backticks**:

```markdown
Текст на английском. Слово `ра̄джа̄ даш́аратхах̣` на санскрите. Продолжение текста.
```

**Результат в EPUB:**
- ✅ Текст отображается **курсивом**
- ✅ **Тёмно-синий цвет** (#1a3a52) для визуального отличия
- ✅ **Без фонового цвета**
- ✅ **Встроенный** в абзац

### Блоки текста на санскрите (тройные backticks)

Для больших текстовых блоков на санскрите используйте **тройные backticks**:

````markdown
```
рāја-дāшаратхах̣ śūро
бхагават-прaтхамах̣ нṛпах̣
```
````

**Результат в EPUB:**
- ✅ Текст отображается **курсивом**
- ✅ **Тёмно-синий цвет** (#1a3a52)
- ✅ **Левая граница** (4px) для визуального отличия блока
- ✅ **Без фонового цвета**
- ✅ **На отдельных строках** (в виде блока)

## Технические детали

### Поддерживаемые шрифты

Оба типа кода (инлайновый и блоки) используют одинаковые шрифты:

1. **DejaVu Serif** — лучшая поддержка Unicode диакритики
2. **Liberation Serif** — альтернатива, часто встроена
3. **Georgia** — fallback на системный шрифт

### CSS правила

#### Инлайновый код:
```css
code {
	font-family: "DejaVu Serif", "Liberation Serif", Georgia, serif;
	font-style: italic;
	color: #1a3a52;
	background-color: transparent;
	padding: 0;
	border-radius: 0;
	letter-spacing: 0.02em;
}
```

#### Блоки текста:
```css
pre {
	font-family: "DejaVu Serif", "Liberation Serif", Georgia, serif;
	font-style: italic;
	color: #1a3a52;
	background-color: transparent;
	padding: 1em;
	border-left: 4px solid #1a3a52;    /* левая граница */
	margin: 1em 0;
	overflow-x: auto;
	letter-spacing: 0.02em;
}
```

## Совместимость

### Проверено на:
- ✅ Kindle Paperwhite (все поколения)
- ✅ Calibre (читалка на ПК)
- ✅ Apple Books
- ✅ Google Play Books
- ✅ Другие EPUB читалки

### Известные особенности:
- На некоторых старых читалках может использоваться системный шрифт вместо DejaVu
- Диакритика всегда поддерживается (это часть Unicode стандарта)
- Переносы слов с диакритикой могут быть ограничены на некоторых устройствах

## Примеры IAST транслитерации

| Символ | Описание |
|--------|-----------|
| ā | долгое 'а' |
| ī | долгое 'и' |
| ū | долгое 'у' |
| ṛ | 'ра' с точкой снизу |
| ḷ | 'ла' с точкой снизу |
| ñ | 'ня' с тильдой |
| ṭ | 'та' с точкой снизу |
| ḍ | 'да' с точкой снизу |
| ṇ | 'на' с точкой снизу |
| ś | 'ша' с острой |
| ṣ | 'ша' с точкой снизу |
| ḥ | висарга (постальвеолярная фрикатива) |

## Тестирование

Для проверки корректности диакритики в EPUB:

1. Сгенерируйте EPUB с флагом `--debug`:
   ```bash
   telegraph-publisher epub -f chapter.md -a "Author" --debug -o book.epub
   ```

2. Откройте временный файл `.epub-temp-*/OEBPS/chapter-1.html` в браузере

3. Проверьте отображение:
   - **Инлайновый код**: `текст` должен быть курсивом и синим
   - **Блоки кода**: многострочный текст должен иметь левую границу

## Проблемы и решения

### Диакритика не видна на Kindle

**Проблема:** Текст отображается, но диакритические знаки не видны

**Решение:**
1. Убедитесь, что используются backticks (`` ` `` или ` ``` `)
2. Проверьте кодировку файла (должна быть UTF-8)
3. Обновите программное обеспечение Kindle
4. Попробуйте конвертировать EPUB в AZW3 через Calibre

### Текст отображается неправильно

**Проблема:** Буквы выглядят странно или наложены друг на друга

**Решение:**
1. Проверьте, что текст именно на санскрите в IAST транслитерации
2. Используйте флаг `--debug` и проверьте HTML вывод
3. Тестируйте на другой читалке (Calibre, Apple Books)

## Примеры использования

### Пример 1: Инлайновый санскрит

```markdown
# Притча о царе

Один царь по имени `rāja-dāśarathaḥ` жил в древние времена.
```

**Результат**: слово будет выделено курсивом и синим цветом, встроено в абзац.

### Пример 2: Стихи на санскрите

```markdown
# Знаменитый стих

Вот классический стих:

```
rāja-dāśarathaḥ śūro
bhagavat-prathamaḥ nṛpaḥ
tapa-śīlo mahā-bhāgaḥ
dharma-jño yukta-buddhi-mān
```

**Результат**: текст отображается в отдельном блоке с левой синей границей.

## Для разработчиков

Если вам нужно изменить стиль отображения санскрита:

1. Отредактируйте CSS в `src/epub/EpubGenerator.ts` (метод `generateCss`)
2. Измените правила для `code` и `pre` элементов
3. Перестройте проект: `bun build`
4. Протестируйте в EPUB читалке

## Ссылки

- [IAST транслитерация](https://en.wikipedia.org/wiki/International_Alphabet_of_Sanskrit_Transliteration)
- [DejaVu Fonts](https://dejavu-fonts.github.io/)
- [EPUB стандарт](https://www.w3.org/publishing/epub32/)
- [Unicode дополнение для диакритики](https://en.wikipedia.org/wiki/Combining_character)



