# Поддержка диакритики в EPUB (IAST и Санскрит)

## Обзор

EPUB генератор `telegraph-publisher` имеет встроенную поддержку корректного отображения текста на санскрите с диакритикой (IAST — International Alphabet of Sanskrit Transliteration) на всех устройствах чтения, включая Kindle Paperwhite.

## Использование

Для выделения текста на санскрите с диакритикой используйте **backticks** (одинарные кавычки):

```markdown
Текст на английском. Слово `ра̄джа̄ даш́аратхах̣` на санскрите. Продолжение текста.
```

### В EPUB результат выглядит как:
- ✅ Текст отображается **курсивом** для визуального отличия
- ✅ Используется **цвет** (#1a3a52 — тёмно-синий) для выделения
- ✅ **Без фонового цвета** (в отличие от программного кода)
- ✅ Диакритика отображается **корректно** на всех устройствах

## Технические детали

### Поддерживаемые шрифты

EPUB использует следующие шрифты в порядке приоритета:

1. **DejaVu Serif** — лучшая поддержка Unicode диакритики на большинстве устройств
2. **Liberation Serif** — альтернатива DejaVu, часто встроена в читалки
3. **Georgia** — fallback на системный шрифт

### CSS правила

```css
code {
	font-family: "DejaVu Serif", "Liberation Serif", Georgia, serif;
	font-style: italic;
	color: #1a3a52;
	background-color: transparent;
	padding: 0;
	border-radius: 0;
	letter-spacing: 0.02em;
}
```

### Для блоков кода (программирование)

Если вам нужны блоки программного кода, используйте тройные backticks:

````markdown
```
function example() {
  return "code";
}
```
````

Блоки кода отображаются:
- ✅ **Моноширинным шрифтом** (DejaVu Sans Mono)
- ✅ **Светлым фоном** (#f4f4f4)
- ✅ **С прокруткой** при переполнении

## Совместимость

### Проверено на:
- ✅ Kindle Paperwhite (все поколения)
- ✅ Calibre (читалка на ПК)
- ✅ Apple Books
- ✅ Google Play Books
- ✅ Другие EPUB читалки

### Известные особенности:
- На некоторых старых читалках может использоваться системный шрифт вместо DejaVu
- Диакритика всегда поддерживается (это часть Unicode стандарта)
- Переносы слов с диакритикой могут быть ограничены на некоторых устройствах

## Примеры IAST транслитерации

```
а̄ = долгое 'а'
ī = долгое 'и'
ū = долгое 'у'
ṛ = 'ра' с точкой снизу
ḷ = 'ла' с точкой снизу
ñ = 'ня' с тильдой
ṭ = 'та' с точкой снизу
ḍ = 'да' с точкой снизу
ṇ = 'на' с точкой снизу
ś = 'ша' с острой
ṣ = 'ша' с точкой снизу
ḥ = 'ха' с точкой после
```

## Тестирование

Для проверки корректности диакритики в EPUB:

1. Сгенерируйте EPUB с флагом `--debug`:
   ```bash
   telegraph-publisher epub -f chapter.md -a "Author" --debug -o book.epub
   ```

2. Откройте временный файл `.epub-temp-*/OEBPS/chapter-1.html` в браузере

3. Проверьте, что текст в backticks:
   - ✅ Отображается курсивом
   - ✅ Имеет тёмно-синий цвет
   - ✅ Диакритика видна корректно

## Проблемы и решения

### Диакритика не видна на Kindle

**Проблема:** Текст отображается, но диакритические знаки не видны

**Решение:**
1. Убедитесь, что используется backticks: `` `текст` ``
2. Проверьте кодировку файла (должна быть UTF-8)
3. Обновите программное обеспечение Kindle
4. Попробуйте конвертировать EPUB в AZW3 через Calibre

### Текст отображается неправильно

**Проблема:** Буквы выглядят странно или наложены друг на друга

**Решение:**
1. Проверьте, что текст именно на санскрите в IAST транслитерации
2. Используйте флаг `--debug` и проверьте HTML вывод
3. Тестируйте на другой читалке (Calibre, Apple Books)

## Для разработчиков

Если вам нужно изменить стиль отображения санскрита:

1. Отредактируйте CSS в `src/epub/EpubGenerator.ts` (метод `generateCss`)
2. Измените правило для `code` элемента:
   ```css
   code {
       font-family: /* ваш шрифт */;
       color: /* ваш цвет */;
       /* другие свойства */
   }
   ```
3. Перестройте проект: `bun build`
4. Протестируйте в EPUB читалке

## Ссылки

- [IAST транслитерация](https://en.wikipedia.org/wiki/International_Alphabet_of_Sanskrit_Transliteration)
- [DejaVu Fonts](https://dejavu-fonts.github.io/)
- [EPUB стандарт](https://www.w3.org/publishing/epub32/)
- [Unicode дополнение для диакритики](https://en.wikipedia.org/wiki/Combining_character)


