# Task: Unify Anchor Generation Between TOC and Link Verification

**Task ID:** 2025-08-04_TASK-030_unify-anchor-generation
**Created:** 2025-08-04 21:00
**Status:** ‚úÖ Complete  
**Phase:** IMPLEMENT Phase ‚Üí Ready for QA Phase

## Description

üéØ **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π –º–µ–∂–¥—É TOC –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å—Å—ã–ª–æ–∫**

–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ:

1. **TOC/Aside –º–µ—Ö–∞–Ω–∏–∑–º** (`generateTocAside` –≤ `markdownConverter.ts`):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é –ª–æ–≥–∏–∫—É: —É–¥–∞–ª–µ–Ω–∏–µ `<` —Å–∏–º–≤–æ–ª–æ–≤ –∏ –∑–∞–º–µ–Ω–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –Ω–∞ –¥–µ—Ñ–∏—Å—ã
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (H5/H6 —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ `>`, `>>`)
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö

2. **Link Verification –º–µ—Ö–∞–Ω–∏–∑–º** (`LinkVerifier.parseAnchorsFromContent`):
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `generateSlug` —Ñ—É–Ω–∫—Ü–∏—é
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
   - –ú–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

## Problem Statement

**–ü—Ä–æ–±–ª–µ–º–∞**: –Ø–∫–æ—Ä—è, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ –¥–ª—è TOC/aside, –º–æ–≥—É—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —è–∫–æ—Ä—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ª–æ–∂–Ω—ã–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è–º –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ anchor-—Å—Å—ã–ª–æ–∫.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- –°—Å—ã–ª–∫–∏ –Ω–∞ —è–∫–æ—Ä—è —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç—å—è—Ö (TOC –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- –ù–æ —Å–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–º–µ—á–∞–µ—Ç —ç—Ç–∏ –∂–µ —Å—Å—ã–ª–∫–∏ –∫–∞–∫ —Å–ª–æ–º–∞–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç false positives –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Å—ã–ª–æ–∫

## User Impact

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–ª, —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ—Ç –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è aside/TOC**, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

## Success Criteria

‚úÖ **–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞**:
1. –ï–¥–∏–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ TOC –∏ link verification
2. –Ø–∫–æ—Ä—è –≤ –∫—ç—à–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —è–∫–æ—Ä—è–º –≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö aside/TOC
3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (–≤–∫–ª—é—á–∞—è H5/H6 —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏)
4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Å—ã–ª–æ–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
5. Backward compatibility —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫—ç—à–∞–º–∏
6. –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å –Ω–æ–≤—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º

## Technical Specification

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:
1. –ò–∑–≤–ª–µ—á—å –ª–æ–≥–∏–∫—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π –∏–∑ `generateTocAside` –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ `LinkVerifier.parseAnchorsFromContent`
3. –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—Å–µ—Ö edge cases (H5/H6, —Å—Å—ã–ª–∫–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö)
4. –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
5. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π