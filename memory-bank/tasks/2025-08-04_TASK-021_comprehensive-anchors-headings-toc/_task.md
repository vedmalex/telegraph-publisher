# TASK-021: Comprehensive Anchors, Headings & ToC System

**Task ID:** TASK-021  
**Date Created:** 2025-08-04_00-11  
**Priority:** High  
**Status:** üî¥ Not Started  
**Phase:** VAN Analysis  

## Overview

–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ç—Ä–µ—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ —Å–∏—Å—Ç–µ–º–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —è–∫–æ—Ä–µ–π, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è –¥–ª—è Telegraph-Publisher. –ó–∞–¥–∞—á–∞ –≤–∫–ª—é—á–∞–µ—Ç —Ç—Ä–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ—ç—Ç–∞–ø–Ω–æ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –ø—É–±–ª–∏–∫—É–µ–º—ã—Ö —Å—Ç–∞—Ç—å—è—Ö.

## Problem Statement

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —è–∫–æ—Ä–µ–π (anchors)
–¢–µ–∫—É—â–∏–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω–∏—è "slug" –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ `LinkVerifier.ts` –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ `anchors.md`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–ª–æ–º–∫–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∏.

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Ç–µ—Ä—è —è–∫–æ—Ä–µ–π –¥–ª—è H5/H6 –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤  
–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ 5-–≥–æ –∏ 6-–≥–æ —É—Ä–æ–≤–Ω–µ–π –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã (`<p>`) –¥–µ–ª–∞–µ—Ç –∏—Ö –Ω–µ–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ—Ä–∞–±–æ—á–∏–º —Å—Å—ã–ª–∫–∞–º –¥–∞–∂–µ –µ—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏—Ö –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç.

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è (`<aside>`)
–£–ø—É—â–µ–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–µ–∞–ª–∏–∑—É–µ–º–æ–π –ø–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –ø—Ä–æ–±–ª–µ–º.

## Technical Specifications

–ó–∞–¥–∞—á–∞ –≤–∫–ª—é—á–∞–µ—Ç —Ç—Ä–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

1. **FEAT-ANCHOR-REFACTOR-001** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —è–∫–æ—Ä–µ–π
2. **FEAT-HEADING-STRATEGY-001** - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
3. **FEAT-ASIDE-TOC-GENERATION-001** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è

## Success Criteria

### Phase 1 (FEAT-ANCHOR-REFACTOR-001):
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ `"–ú–æ–π —è–∫–æ—Ä—å"` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —è–∫–æ—Ä—å `"–ú–æ–π-—è–∫–æ—Ä—å"`
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–æ–∫ `"–ü—Ä–∏–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ ‚Ññ1"` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —è–∫–æ—Ä—å `"–ü—Ä–∏–º–µ—Ä-–∑–∞–≥–æ–ª–æ–≤–∫–∞-‚Ññ1"`
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä —Å–∏–º–≤–æ–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è: `"Section Title"` -> `"Section-Title"`
- ‚úÖ –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è

### Phase 2 (FEAT-HEADING-STRATEGY-001):
- ‚úÖ `##### –ó–∞–≥–æ–ª–æ–≤–æ–∫ 5` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `{ tag: 'h4', children: ['¬ª –ó–∞–≥–æ–ª–æ–≤–æ–∫ 5'] }`
- ‚úÖ `###### –ó–∞–≥–æ–ª–æ–≤–æ–∫ 6` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ `{ tag: 'h4', children: ['¬ª¬ª –ó–∞–≥–æ–ª–æ–≤–æ–∫ 6'] }`
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ H1-H4 –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ —Ä–∞–Ω—å—à–µ (H1-H3 -> `h3`, H4 -> `h4`)
- ‚úÖ –í—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —è–∫–æ—Ä—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Telegra.ph

### Phase 3 (FEAT-ASIDE-TOC-GENERATION-001):
- ‚úÖ –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ 2+ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—è–≤–ª—è–µ—Ç—Å—è –±–ª–æ–∫ `<aside>`
- ‚úÖ –ë–ª–æ–∫ `<aside>` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (`<ul>`) —Å—Å—ã–ª–æ–∫
- ‚úÖ –ö–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —è–∫–æ—Ä—å –∏–∑ Phase 1
- ‚úÖ –¢–µ–∫—Å—Ç —Å—Å—ã–ª–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞–º —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ –∏–∑ Phase 2
- ‚úÖ –ü—Ä–∏ <2 –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –±–ª–æ–∫ `<aside>` –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

## Quality Assurance Requirements

- **Code Coverage:** 85% minimum
- **Test Success Rate:** 100%
- **Test Types:** Unit tests, integration tests, edge cases
- **Test Placement:** Colocated with source files
- **Specification Compliance:** Complete validation against all three technical specs

## File Modification Scope

### Files to be Modified:
- `src/links/LinkVerifier.ts` - Phase 1: –§—É–Ω–∫—Ü–∏—è `generateSlug`
- `src/markdownConverter.ts` - Phase 2: –õ–æ–≥–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- `src/markdownConverter.ts` - Phase 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `generateTocAside`

### Test Files to be Created/Updated:
- `src/links/LinkVerifier.test.ts` - –¢–µ—Å—Ç—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π
- `src/markdownConverter.test.ts` - –¢–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è

## Dependencies and Constraints

- –î–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `TelegraphNode`
- –î–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º Telegra.ph
- –î–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ–π –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∏—Å–∫–æ–≤

## Expected Deliverables

1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `generateSlug` –≤ `LinkVerifier.ts`
2. –ù–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ `markdownConverter.ts`
3. –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è `generateTocAside`
4. –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º 85%+
5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ö

## Task Structure

```
üìã TASK-021: Comprehensive Anchors, Headings & ToC System
‚îú‚îÄ‚îÄ üîç Phase 1: VAN Analysis
‚îú‚îÄ‚îÄ üìù Phase 2: PLAN Implementation Strategy  
‚îú‚îÄ‚îÄ üé® Phase 3: CREATIVE Design Decisions
‚îú‚îÄ‚îÄ ‚öôÔ∏è Phase 4: IMPLEMENT (3 Sequential Sub-phases)
‚îÇ   ‚îú‚îÄ‚îÄ Sub-phase 4.1: FEAT-ANCHOR-REFACTOR-001
‚îÇ   ‚îú‚îÄ‚îÄ Sub-phase 4.2: FEAT-HEADING-STRATEGY-001
‚îÇ   ‚îî‚îÄ‚îÄ Sub-phase 4.3: FEAT-ASIDE-TOC-GENERATION-001
‚îú‚îÄ‚îÄ ‚úÖ Phase 5: QA Comprehensive Testing
‚îî‚îÄ‚îÄ ü§î Phase 6: REFLECT Documentation & Lessons
```

## Notes

–≠—Ç–∞ –∑–∞–¥–∞—á–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –ø—É–±–ª–∏–∫—É–µ–º—ã—Ö —Å—Ç–∞—Ç—å—è—Ö –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫. –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∏—Å–∫–∏ –ø–æ–ª–æ–º–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.