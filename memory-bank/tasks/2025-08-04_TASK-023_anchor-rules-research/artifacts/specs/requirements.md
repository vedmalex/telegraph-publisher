# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è: –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π (Anchors) –≤ Telegra.ph

**ID –ó–∞–¥–∞—á–∏:** `RESEARCH-ANCHOR-RULES-001`
**–î–∞—Ç–∞:** `2025-08-04`
**–ê–≤—Ç–æ—Ä:** `External Agent (Technical Specs)`
**–°—Ç–∞—Ç—É—Å:** `–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏`

## 1. –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —ç–º–ø–∏—Ä–∏—á–µ—Å–∫–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∫–æ—Ç–æ—Ä—ã–π Telegra.ph –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ `id` –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (—è–∫–æ—Ä–µ–π) –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`h3`, `h4`). –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å—Ç–∞–Ω—É—Ç –æ—Å–Ω–æ–≤–æ–π –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

## 2. –û–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–°–∫—Ä–∏–ø—Ç `scripts/research_anchors.ts` –±—É–¥–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Telegra.ph. –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞–±–æ—Ä —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, –≤–∫–ª—é—á–∞—é—â–∏—Ö —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã, –∫–∏—Ä–∏–ª–ª–∏—Ü—É, –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è –∏ Markdown-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –∫–æ–Ω—Å–æ–ª—å.

## 3. –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### A. –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–∞:
`scripts/research_anchors.ts`

### B. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
* `src/telegraphPublisher.ts` (–∫–ª–∞—Å—Å `TelegraphPublisher`)

### C. –õ–æ–≥–∏–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞:

#### 1. –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–Ω—É—Ç—Ä–∏ —Å–∫—Ä–∏–ø—Ç–∞ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏. –≠—Ç–æ—Ç –º–∞—Å—Å–∏–≤ –¥–æ–ª–∂–µ–Ω –ø–æ–∫—Ä—ã–≤–∞—Ç—å –≤—Å–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–ª—É—á–∞–∏:

```typescript
const testHeadings = [
  // Basic cases
  "Simple Title",
  "Title With Spaces",
  // Cyrillic
  "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ",
  "–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏",
  // Numbers
  "1. Numbered Heading",
  "Heading with 123",
  // Special Characters (common)
  "Title with dot.",
  "Title with comma,",
  "Title with colon:",
  "Title with question mark?",
  "Title with exclamation!",
  // Special Characters (problematic from logs)
  "–ê–Ω–∞–ª–æ–≥–∏—è ¬´–î–µ—Ä–µ–≤–æ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏¬ª (–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –®–ë 1.1.4)",
  "–í–æ–ø—Ä–æ—Å 4: –û–ø–∏—à–∏—Ç–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –∏ —Å–ª—É—à–∞—Ç—å ¬´–®—Ä–∏–º–∞–¥-–ë—Ö–∞–≥–∞–≤–∞—Ç–∞–º¬ª.",
  // Other symbols
  "Title with @#$%^&*()_+-=[]{}|;'\"<>/",
  // Mixed case
  "MixedCaseTitle",
  "Title With Mixed Case",
  // Markdown formatting
  "**Bold Title**",
  "*Italic Title*",
  "`Code Title`",
  "[Link Title](url)",
  "**Bold *and Italic* Title**"
];
```

#### 2. –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
–°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å –æ–¥–∏–Ω –∞—Ä–≥—É–º–µ–Ω—Ç ‚Äî `access_token`. –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω, –≤—ã–≤–æ–¥–∏—Ç—å –æ—à–∏–±–∫—É.

#### 3. –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (`async function main()`)
* –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä `TelegraphPublisher`
* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
* –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –º–∞—Å—Å–∏–≤ `testHeadings` –≤ –º–∞—Å—Å–∏–≤ `TelegraphNode[]`, –≥–¥–µ –∫–∞–∂–¥—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `h3` —ç–ª–µ–º–µ–Ω—Ç–æ–º
* –í—ã–∑–≤–∞—Ç—å `publisher.publishNodes()` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º "Anchor Research Page" –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º —É–∑–ª–æ–≤
* –í—ã–≤–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Å–æ–ª—å URL –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
* –û–±–µ—Ä–Ω—É—Ç—å –≤—ã–∑–æ–≤ –≤ `try...catch` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ API

### D. –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (`scripts/research_anchors.ts`):

```typescript
import { TelegraphPublisher, type TelegraphNode } from '../src/telegraphPublisher';

const testHeadings: string[] = [
  "Simple Title",
  "Title With Spaces",
  "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ",
  "–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏",
  "1. Numbered Heading",
  "Heading with 123",
  "Title with dot.",
  "Title with comma,",
  "Title with colon:",
  "Title with question mark?",
  "Title with exclamation!",
  "–ê–Ω–∞–ª–æ–≥–∏—è ¬´–î–µ—Ä–µ–≤–æ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏¬ª (–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –®–ë 1.1.4)",
  "–í–æ–ø—Ä–æ—Å 4: –û–ø–∏—à–∏—Ç–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –∏ —Å–ª—É—à–∞—Ç—å ¬´–®—Ä–∏–º–∞–¥-–ë—Ö–∞–≥–∞–≤–∞—Ç–∞–º¬ª.",
  "Title with @#$%^&*()_+-=[]{}|;'\"<>/",
  "MixedCaseTitle",
  "Title With Mixed Case",
  "**Bold Title**",
  "*Italic Title*",
  "`Code Title`",
  "[Link Title](url)",
  "**Bold *and Italic* Title**"
];

async function main() {
  const accessToken = process.argv[2];

  if (!accessToken) {
    console.error("‚ùå Error: Access token is required.");
    console.log("Usage: bun scripts/research_anchors.ts <YOUR_ACCESS_TOKEN>");
    process.exit(1);
  }

  try {
    console.log("üöÄ Starting anchor research publication...");
    const publisher = new TelegraphPublisher();
    publisher.setAccessToken(accessToken);

    const nodes: TelegraphNode[] = testHeadings.map(text => ({
      tag: 'h3',
      children: [text]
    }));

    const page = await publisher.publishNodes("Anchor Research Page", nodes);

    console.log("\n‚úÖ Publication successful!");
    console.log("=======================================");
    console.log("üîó URL:", page.url);
    console.log("=======================================");
    console.log("\nüïµÔ∏è‚Äç‚ôÇÔ∏è Next Steps:");
    console.log("1. Open the URL above in your browser.");
    console.log("2. Right-click on each heading and select 'Inspect'.");
    console.log("3. In the developer tools, find the `id` attribute of the `<h3>` tag.");
    console.log("4. Compare the original heading text with the generated `id` to determine the rules.");

  } catch (error) {
    console.error("‚ùå Publication failed:", error instanceof Error ? error.message : String(error));
    process.exit(1);
  }
}

// Execute the script
main();
```

## 4. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ** –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω—ã–π –≤—ã—à–µ –∫–æ–¥ –≤ —Ñ–∞–π–ª `scripts/research_anchors.ts`
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ** —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, –ø–µ—Ä–µ–¥–∞–≤ –≤–∞—à —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞:
   ```bash
   bun run scripts/research_anchors.ts <–í–ê–®_ACCESS_TOKEN>
   ```
3. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   * –û—Ç–∫—Ä–æ–π—Ç–µ URL, –∫–æ—Ç–æ—Ä—ã–π —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å
   * –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –∫–ª–∏–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–≥–æ–ª–æ–≤–∫—É –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "Inspect" (–∏–ª–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç")
   * –í –æ—Ç–∫—Ä—ã–≤—à–µ–π—Å—è –ø–∞–Ω–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞–π–¥–∏—Ç–µ `id` –∞—Ç—Ä–∏–±—É—Ç —É —Ç–µ–≥–∞ `<h3>`. –ù–∞–ø—Ä–∏–º–µ—Ä: `<h3 id="Zagalovok-na-kirillice">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ</h3>`
   * –°—Ä–∞–≤–Ω–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º `id`, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

## 5. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —É –Ω–∞—Å –±—É–¥–µ—Ç —Ç–æ—á–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Å–º–æ–∂–µ–º –∑–∞–ª–æ–∂–∏—Ç—å –≤ –æ—Å–Ω–æ–≤—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

## 6. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

1. ‚úÖ –°–∫—Ä–∏–ø—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –≤ `scripts/research_anchors.ts`
2. ‚úÖ –°–∫—Ä–∏–ø—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç
3. ‚úÖ –í–∫–ª—é—á–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Telegra.ph
5. ‚úÖ –í—ã–≤–æ–¥ URL –∏ —á–µ—Ç–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## 7. –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

* `src/telegraphPublisher.ts` - –æ—Å–Ω–æ–≤–Ω–æ–π API –∫–ª–∞—Å—Å
* `src/links/LinkVerifier.ts` - –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
* `src/markdownConverter.ts` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —É–ª—É—á—à–µ–Ω–∞
* `src/doc/anchors.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## 8. –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–∞–≤–∏–ª–∞—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π:
1. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é `src/doc/anchors.md`
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `LinkVerifier.getAnchorsForFile()`
3. –£–ª—É—á—à–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ–≥–ª–∞–≤–ª–µ–Ω–∏—è –≤ `markdownConverter`
4. –û–±–Ω–æ–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã